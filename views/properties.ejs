<!DOCTYPE html>
<html lang="en">
<%- include('header'); -%>
<body>
<%- include('nav'); -%>

<main class="container properties-container">
  <aside class="filters-sidebar">
    <h3>Filters</h3>
    <form action="/properties" method="GET" id="filterForm">
      <div class="filter-group">
        <label for="city">City</label>
        <select name="city" id="city">
          <option value="">All Cities</option>
          <% cities.forEach(city => { %>
            <option value="<%= city.name %>" <%= currentCity === city.name ? 'selected' : '' %>>
              <%= city.name %>
            </option>
          <% }); %>
        </select>
      </div>

      <div class="filter-group">
        <label for="maxPrice">Max Price</label>
        <input type="range" id="maxPrice" name="maxPrice" min="2000" max="50000" value="50000">
        <span id="priceDisplay">₹50,000</span>
      </div>

      <div class="filter-group">
        <label>Property Type</label>
        <div class="checkbox-group">
          <label><input type="checkbox" name="propertyType" value="pg"> PG</label>
          <label><input type="checkbox" name="propertyType" value="hostel"> Hostel</label>
          <label><input type="checkbox" name="propertyType" value="flat"> Flat</label>
        </div>
      </div>

      <div class="filter-group">
        <label>Room Type</label>
        <div class="checkbox-group">
          <label><input type="checkbox" name="roomType" value="single"> Single</label>
          <label><input type="checkbox" name="roomType" value="double"> Double</label>
          <label><input type="checkbox" name="roomType" value="triple"> Triple</label>
          <label><input type="checkbox" name="roomType" value="shared"> Shared</label>
        </div>
      </div>

      <div class="filter-group">
        <label for="gender">Gender Preference</label>
        <select name="genderPreference" id="gender">
          <option value="">Any</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="any">Mixed</option>
        </select>
      </div>

      <button type="submit" class="btn-primary">Apply Filters</button>
    </form>
  </aside>

  <section class="properties-main">
    <div class="properties-header">
      <h2><%= currentSearch ? `Search: "${currentSearch}"` : currentCity ? `Properties in ${currentCity}` : 'All Properties' %></h2>
      <p><%= properties.length %> properties found</p>
    </div>

    <% if (properties.length > 0) { %>
      <div class="properties-grid">
        <% properties.forEach(property => { %>
          <a href="/property/<%= property.id %>" class="property-card">
            <div class="property-image">
              <img src="<%= property.images && property.images[0] ? property.images[0] : '/placeholder.jpg' %>" alt="<%= property.title %>">
              <span class="property-type"><%= property.propertyType %></span>
            </div>
            <div class="property-info">
              <h3><%= property.title %></h3>
              <p class="location"><%= property.area %>, <%= property.city %></p>
              <div class="amenities">
                <% if (property.amenities && property.amenities.length > 0) { %>
                  <% property.amenities.slice(0, 3).forEach(amenity => { %>
                    <span class="amenity-tag"><%= amenity %></span>
                  <% }); %>
                <% } else { %>
                  <span class="amenity-tag">Standard Amenities</span>
                <% } %>
              </div>
              <div class="property-footer">
                <span class="price">₹<%= property.price.toLocaleString('en-IN') %></span>
                <span class="rating">⭐ <%= property.rating || 4.5 %></span>
              </div>
            </div>
          </a>
        <% }); %>
      </div>
    <% } else { %>
      <p class="no-results">No properties found. Try adjusting your filters.</p>
    <% } %>
  </section>
</main>

<%- include('footer'); -%>

<script>
  const priceInput = document.querySelector('input[name="maxPrice"]');
  const priceDisplay = document.getElementById('priceDisplay');
  
  if (priceInput) {
    priceInput.addEventListener('input', (e) => {
      priceDisplay.textContent = '₹' + parseInt(e.target.value).toLocaleString('en-IN');
    });
  }
</script>
</body>
</html>
